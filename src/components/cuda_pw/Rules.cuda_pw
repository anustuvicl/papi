# Note: If PAPI_CUDA_ROOT environment variable is set then build using $PAPI_CUDA_ROOT/bin/nvcc.
# If not set find nvcc installed on system and set it.
PAPI_CUDA_ROOT ?= $(shell dirname $(shell dirname $(shell which nvcc)))

CUDA_MACS = -DPAPI_CUDA_MAIN=$(PAPI_CUDA_MAIN) -DPAPI_CUDA_RUNTIME=$(PAPI_CUDA_RUNTIME)
CUDA_MACS+= -DPAPI_CUDA_CUPTI=$(PAPI_CUDA_CUPTI) -DPAPI_CUDA_PERFWORKS=$(PAPI_CUDA_PERFWORKS)

COMPSRCS += components/cuda_pw/linux-cuda.c \
            components/cuda_pw/lcuda_dispatch.c \
			components/cuda_pw/lcuda_common.c \
			components/cuda_pw/lcuda_utils.c \
			components/cuda_pw/cupti_profiler.c \
			components/cuda_pw/cupti_events.c \

COMPOBJS += linux-cuda.o lcuda_dispatch.o lcuda_common.o lcuda_utils.o cupti_profiler.o cupti_events.o

# CFLAGS specifies compile flags; need include files here, and macro defines.
CFLAGS += -I$(PAPI_CUDA_ROOT)/include -I$(PAPI_CUDA_ROOT)/extras/CUPTI/include -g $(CUDA_MACS)
LDFLAGS += $(LDL)

linux-cuda.o: components/cuda_pw/linux-cuda.c $(HEADERS)
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c components/cuda_pw/linux-cuda.c -o linux-cuda.o

lcuda_dispatch.o: components/cuda_pw/lcuda_dispatch.c
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c components/cuda_pw/lcuda_dispatch.c -o lcuda_dispatch.o

lcuda_common.o: components/cuda_pw/lcuda_common.c $(HEADERS)
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c components/cuda_pw/lcuda_common.c -o lcuda_common.o

lcuda_utils.o: components/cuda_pw/lcuda_utils.c
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c components/cuda_pw/lcuda_utils.c -o lcuda_utils.o

cupti_profiler.o: components/cuda_pw/cupti_profiler.c
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c components/cuda_pw/cupti_profiler.c -o cupti_profiler.o

cupti_events.o: components/cuda_pw/cupti_events.c
	$(CC) $(LIBCFLAGS) $(OPTFLAGS) -c components/cuda_pw/cupti_events.c -o cupti_events.o
